# MCP (Model Context Protocol) Integration

## üìã –û–±–∑–æ—Ä

MCP Server –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç LLM –º–æ–¥–µ–ª—è–º –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    LLM (llama3.2)                            ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  "–ù–∞ –∫–∞–∫–æ–π –≤–µ—Ç–∫–µ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º?"                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
         JSON-RPC –ø–æ–≤–µ—Ä—Ö stdin/stdout
                   ‚îÇ
                   ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              MCP Server (stdio transport)                    ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools):                                       ‚îÇ
‚îÇ  ‚Ä¢ git_branch - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É                     ‚îÇ
‚îÇ  ‚Ä¢ git_status - –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
         –í—ã–∑—ã–≤–∞–µ—Ç GitHelper
                   ‚îÇ
                   ‚Üì
         –í—ã–ø–æ–ª–Ω—è–µ—Ç git –∫–æ–º–∞–Ω–¥—ã
```

## üì¶ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### `src/mcp/gitServer.ts`
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `@modelcontextprotocol/sdk`:

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
const server = new McpServer({
  name: 'git-mcp-server',
  version: '1.0.0',
}, {
  capabilities: { tools: {} },
});

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
server.tool('git_branch', 'Get current git branch', {}, async () => {
  // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
});

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
const transport = new StdioServerTransport();
await server.connect(transport);
```

### `mcp-server.js`
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞:

```bash
node mcp-server.js
```

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools)

### 1. `git_branch`
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏

**–í—Ö–æ–¥:** –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
**–í—ã—Ö–æ–¥:** `"Current git branch: main"`

### 2. `git_status`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

**–í—Ö–æ–¥:** –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
**–í—ã—Ö–æ–¥:**
```
Git Status:
 M src/chatbot.ts
 M src/codeAssistant.ts
?? test-mcp.js
```

## üöÄ –ó–∞–ø—É—Å–∫ MCP –°–µ—Ä–≤–µ—Ä–∞

### –°–ø–æ—Å–æ–± 1: –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫
```bash
node mcp-server.js
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ chat –∫–æ–º–∞–Ω–¥—É /mcp
```bash
node bin/cli.js chat
# > /mcp start
# üîå Git MCP Server started on stdio
```

### –°–ø–æ—Å–æ–± 3: –í production (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å Claude Desktop)
MCP —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `~/.claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "git": {
      "command": "node",
      "args": ["/path/to/mcp-server.js"]
    }
  }
}
```

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª JSON-RPC

MCP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON-RPC 2.0 –ø–æ–≤–µ—Ä—Ö stdin/stdout.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/list"
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—Ö)
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "git_branch",
        "description": "Get the current git branch name",
        "inputSchema": { "type": "object", "properties": {} }
      }
    ]
  }
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (–æ—à–∏–±–∫–∞)
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32603,
    "message": "Internal server error"
  }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP –°–µ—Ä–≤–µ—Ä–∞

### –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MCP Inspector
MCP Inspector - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)
npm install -g @modelcontextprotocol/inspector

# –ó–∞–ø—É—Å–∫ –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
node mcp-server.js

# –ó–∞–ø—É—Å–∫ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
mcp-inspector node mcp-server.js
```

MCP Inspector –æ—Ç–∫—Ä–æ–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–¥–µ –º–æ–∂–Ω–æ:
- –£–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –í—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å JSON-RPC –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ stdin/stdout
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
node mcp-server.js

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å JSON-RPC –∑–∞–ø—Ä–æ—Å
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | node mcp-server.js
```

### –°–ø–æ—Å–æ–± 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ chat
```bash
node bin/cli.js chat

You: /mcp start
# MCP Server started

# LLM –º–æ–∂–µ—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å git –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
You: What branch are we on?
# Assistant –∏—Å–ø–æ–ª—å–∑—É–µ—Ç git_branch tool —á–µ—Ä–µ–∑ MCP
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å MCP

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MCP –ø–æ–¥—Ö–æ–¥–∞:

1. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –¥–æ—Å—Ç—É–ø** - LLM –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è** - JSON-RPC –ø–æ–≤–µ—Ä—Ö stdin/stdout, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
3. **–ê—É–¥–∏—Ç** - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞
4. **–ò–∑–æ–ª—è—Ü–∏—è** - MCP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:

```typescript
// MCP –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ LLM –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ:
server.tool('git_branch', ...);    // ‚úÖ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
server.tool('git_status', ...);    // ‚úÖ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ

// LLM –ù–ï –º–æ–∂–µ—Ç:
// ‚ùå –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é shell –∫–æ–º–∞–Ω–¥—É
// ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª—ã
// ‚ùå –£–¥–∞–ª–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
// ‚ùå –°–¥–µ–ª–∞—Ç—å force push
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CodeAssistant

–í `src/codeAssistant.ts`:

```typescript
private mcpServer: GitMCPServer | null = null;

async initialize() {
  // ...
  this.mcpServer = new GitMCPServer(this.config.paths.git);
  // ...
}

async startMCPServer(): Promise<void> {
  await this.mcpServer?.start();
}

async stopMCPServer(): Promise<void> {
  await this.mcpServer?.stop();
}
```

## üìö –°—Å—ã–ª–∫–∏

- [MCP Documentation](https://modelcontextprotocol.io/)
- [MCP SDK –¥–ª—è TypeScript](https://github.com/modelcontextprotocol/typescript-sdk)
- [MCP Inspector](https://github.com/modelcontextprotocol/inspector)

## üéØ –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

```typescript
// –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
server.tool('git_files', 'List changed files', {}, async () => {
  // —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
});

// –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤
server.tool('git_log', 'Get commit history', {}, async () => {
  // —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
});

// –†–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É –≤–µ—Ç–∫–∞–º–∏
server.tool('git_diff', 'Show git diff', {
  branch: { type: 'string', description: 'Branch to compare' }
}, async (args) => {
  // —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
});
```
